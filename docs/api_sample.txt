# Check if Server is Initiatated
Invoke-RestMethod -Uri "http://localhost:8080/api/initdone"

# Init the Database

$body = @{
     force_migrate = $true
     default_wallet_name = "My Wallet"
     admin_username = "admin1"
     admin_password = "pass123"
     admin_email = "admin1@example.com"
     admin_name = "Administrator"
 } | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/init" `
   -Method Post `
   -Headers @{"Content-Type"="application/json"} `
   -Body $body


# Create User

$uri = "http://localhost:8080/api/users"

$body = @{
     username           = "johndoe1"
     name               = "John Doe"
     email              = "john.doe1@example.com"
     password           = "StrongPassword123!"
     user_type          = "regular"       # must match models.UserType
     wallet_name        = "Main Wallet"
     wallet_group_name  = "Personal"
     create_categories  = $true
 } | ConvertTo-Json -Depth 3

Invoke-RestMethod `
     -Uri $uri `
     -Method Post `
     -Headers @{
         "Content-Type" = "application/json"
     } `
    -Body $body

# Get List of users

Invoke-RestMethod -Uri http://localhost:8080/api/users

# Modify a User

$uri = "http://localhost:8080/api/users/5"
$body = @{
     username = "new_username"
 } | ConvertTo-Json

Invoke-RestMethod `
     -Uri $uri `
     -Method Put `
     -ContentType "application/json" `
     -Body $body

# Add user to wallet

Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets/2" -Method POST

# Detach user from wallet
Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets/2" -Method DELETE

# List User1 wallet
Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets" -Method GET

# Repalce user's wallet
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/users/1/wallets" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{ "wallet_ids": [1, 3, 5] }'

# Create New Wallet 

Invoke-RestMethod `
   -Uri "http://localhost:8080/api/wallets" `
   -Method POST `
   -Headers @{ "Content-Type" = "application/json" } `
   -Body '{
     "name": "Main Wallet",
     "icon": "X",
     "is_enabled": true,
     "balance": 1000
   }'

# Update wallet 

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "name": "Updated Wallet Name",
    "icon": "üè¶",
    "is_enabled": true,
    "balance": 2500
  }'


# Create walletgroup

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "wallet_group_name": "Family Expenses"
  }'

# List all wallet group
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups" `
  -Method GET


# Get wallet group by ID 
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1" `
  -Method GET

# Update Wallet Group Name
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "wallet_group_name": "Updated Family Group"
  }'

# Delete wallet group
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1" `
  -Method DELETE

# Attach Wallet to Wallet Group

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1/wallets/2" `
  -Method POST

# Detach Wallet from Wallet Group
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1/wallets/2" `
  -Method DELETE

# List Wallets in a Wallet Group
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1/wallets" `
  -Method GET

# Replace Wallets in a Wallet Group (attach multiple at once)

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/walletgroups/1/wallets" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "wallet_ids": [1, 2, 3]
  }'

# List Wallet Groups for a User (via ORM preload)
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/users/1/walletgroups" `
  -Method GET

# Create a Category for a Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "name": "Groceries",
    "icon": "üõí",
    "parent_id": null,
    "is_global": false
  }'

# Create a Global Category (syncs to all wallets)

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "name": "Transportation",
    "icon": "üöó",
    "parent_id": null,
    "is_global": true
  }'

# List Categories for a Wallet (flat list)

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories" `
  -Method GET

# Get Category Tree for a Wallet (hierarchical)

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories/tree" `
  -Method GET

# Get a Specific Category

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories/5" `
  -Method GET

# Update a Category

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories/5" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "name": "Updated Groceries",
    "icon": "üõí",
    "is_global": true
  }'

# Delete a Category

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories/5" `
  -Method DELETE

# Sync Global Category to All Wallets

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/categories/5/sync-global" `
  -Method POST

# Create a Person

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/persons" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "person_name": "John Smith",
    "alias": "Johnny"
  }'

# List All Persons

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/persons" `
  -Method GET

# Get a Specific Person

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/persons/1" `
  -Method GET

# Update a Person

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/persons/1" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "person_name": "Updated Name",
    "alias": "Updated Alias"
  }'

# Delete a Person

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/persons/1" `
  -Method DELETE

# Create a Transaction

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/transactions" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "wallet_id": 1,
    "category_id": 1,
    "amount": 50.00,
    "person_name": "New Person",
    "note": "Lunch expense",
    "user_id": 1
  }'

# List All Transactions

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/transactions" `
  -Method GET

# Get a Specific Transaction

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/transactions/1" `
  -Method GET

# Update a Transaction

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/transactions/1" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "amount": 60.00,
    "note": "Updated note"
  }'

# Delete a Transaction

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/transactions/1" `
  -Method DELETE

# Create a Transaction for a Specific Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/transactions" `
  -Method POST `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "category_id": 1,
    "amount": 50.00,
    "person_name": "New Person",
    "note": "Lunch expense",
    "user_id": 1
  }'

# List Transactions for a Specific Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/transactions" `
  -Method GET

# Get a Specific Transaction for a Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/transactions/13" `
  -Method GET

# Update a Transaction for a Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/transactions/13" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "amount": 60.00,
    "note": "Updated note"
  }'

# Delete a Transaction for a Wallet

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1/transactions/13" `
  -Method DELETE

