# Check if Server is Initiatated
Invoke-RestMethod -Uri "http://localhost:8080/api/initdone"

# Init the Database

$body = @{
     force_migrate = $true
     default_wallet_name = "My Wallet"
     admin_username = "admin1"
     admin_password = "pass123"
     admin_email = "admin1@example.com"
     admin_name = "Administrator"
 } | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/init" `
   -Method Post `
   -Headers @{"Content-Type"="application/json"} `
   -Body $body


# Create User

$uri = "http://localhost:8080/api/users"

$body = @{
     username           = "johndoe1"
     name               = "John Doe"
     email              = "john.doe1@example.com"
     password           = "StrongPassword123!"
     user_type          = "regular"       # must match models.UserType
     wallet_name        = "Main Wallet"
     wallet_group_name  = "Personal"
     create_categories  = $true
 } | ConvertTo-Json -Depth 3

Invoke-RestMethod `
     -Uri $uri `
     -Method Post `
     -Headers @{
         "Content-Type" = "application/json"
     } `
    -Body $body

# Get List of users

Invoke-RestMethod -Uri http://localhost:8080/api/users

# Modify a User

$uri = "http://localhost:8080/api/users/5"
$body = @{
     username = "new_username"
 } | ConvertTo-Json

Invoke-RestMethod `
     -Uri $uri `
     -Method Put `
     -ContentType "application/json" `
     -Body $body

# Add user to wallet

Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets/2" -Method POST

# Detach user from wallet
Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets/2" -Method DELETE

# List User1 wallet
Invoke-RestMethod -Uri "http://localhost:8080/api/users/1/wallets" -Method GET

# Repalce user's wallet
Invoke-RestMethod `
  -Uri "http://localhost:8080/api/users/1/wallets" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{ "wallet_ids": [1, 3, 5] }'

# Create New Wallet 

Invoke-RestMethod `
   -Uri "http://localhost:8080/api/wallets" `
   -Method POST `
   -Headers @{ "Content-Type" = "application/json" } `
   -Body '{
     "name": "Main Wallet",
     "icon": "X",
     "is_enabled": true,
     "balance": 1000
   }'

# Update wallet 

Invoke-RestMethod `
  -Uri "http://localhost:8080/api/wallets/1" `
  -Method PUT `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{
    "name": "Updated Wallet Name",
    "icon": "üè¶",
    "is_enabled": true,
    "balance": 2500
  }'

